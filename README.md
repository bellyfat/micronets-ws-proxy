# Micronets DHCP Test Readme

## Setting up the proxy


### Generating the shared root certificate used for websocket communication:

This will produce the root certificate and key for validating/generating
leaf certificates used by peers of the websocket proxy:

```
bin/gen-ocf-root-cert --cert-basename lib/micronets-ws-root \
    --subject-org-name "Micronets Websocket Root Cert" \
    --expiration-in-days 3650
```

The shared root cert will be the basis for trust for all the entities
communicating via the websocket proxy. The websocket proxy will only 
trust peers that present a cert (and can accept a challenge from) the
proxy.

The `micronets-ws-root.key.pem` file generated by this script should
only be retained for the purposes of generating new leaf certs for the
websocket peers.

### To generate the cert to be used for the Websocket Proxy:

```
bin/gen-ocf-leaf-cert --cert-basename lib/micronets-ws-proxy \
    --subject-org-name "Micronets Websocket Proxy Cert" \
    --expiration-in-days 3650 \
    --ca-certfile lib/micronets-ws-root.cert.pem \
    --ca-keyfile lib/micronets-ws-root.key.pem

cat lib/micronets-ws-proxy.cert.pem lib/micronets-ws-proxy.key.pem > lib/micronets-ws-proxy.pkeycert.pem
```

The `lib/micronets-ws-proxy.pkeycert.pem` file must be deployed with the 
Micronets websocket proxy and well-protected. The `lib/micronets-ws-root.cert.pem`
must be added to the Proxy's list of trusted CAs. (and should really be the only
CA enabled for the proxy)

### Generating the cert to be used for the Micronets Manager:

```
bin/gen-ocf-leaf-cert --cert-basename lib/micronets-manager \
    --subject-org-name "Micronets Manager Cert" \
    --expiration-in-days 3650 \
    --ca-certfile lib/micronets-ws-root.cert.pem \
    --ca-keyfile lib/micronets-ws-root.key.pem

cat lib/micronets-manager.cert.pem lib/micronets-manager.key.pem > lib/micronets-manager.pkeycert.pem
```

The `lib/micronets-manager.pkeycert.pem` file must be deployed with the 
Micronets Manager to connect to the websocket proxy and `lib/micronets-ws-root.cert.pem` 
must be added to the Micronet's Manager CA list.

### To generate the cert to be used for the Micronets DHCP Manager:

```
bin/gen-ocf-leaf-cert --cert-basename lib/micronets-dhcp-manager \
    --subject-org-name "Micronets DHCP Manager Cert" \
    --expiration-in-days 3650 \
    --ca-certfile lib/micronets-ws-root.cert.pem \
    --ca-keyfile lib/micronets-ws-root.key.pem

cat lib/micronets-dhcp-manager.cert.pem lib/micronets-dhcp-manager.key.pem > lib/micronets-dhcp-manager.pkeycert.pem
```

The `lib/micronets-manager.pkeycert.pem` file must be deployed with the 
Micronets Manager to connect to the websocket proxy and `lib/micronets-ws-root.cert.pem` 
must be added to the Micronet's Manager CA list.

### To generate the cert to be used by the test client:

```
bin/gen-ocf-leaf-cert --cert-basename lib/micronets-ws-test-client \
    --subject-org-name "Micronets Websocket Test Client Cert" \
    --expiration-in-days 3650 \
    --ca-certfile lib/micronets-ws-root.cert.pem \
    --ca-keyfile lib/micronets-ws-root.key.pem

cat lib/micronets-ws-test-client.cert.pem lib/micronets-ws-test-client.key.pem > lib/micronets-ws-test-client.pkeycert.pem
```
